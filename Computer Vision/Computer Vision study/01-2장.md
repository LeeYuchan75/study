### 영상 처리 (Image Processing)

- **영상 처리 (Image Processing)** : 특정 목적을 달성하려고 원래 영상을 개선된 새로운 영상으로 변환하는 작업

    - 화질 개선 자체가 목적일 경우에 사용
 
    - 컴퓨터 비전은 영상 처리를 전처리로 활용하여 인식 성능을 향상함
      
![System Resources](../../images/Computer%20Vision%20images/안개예시.png)

<br/>

### 컴퓨터비전 & 영상 처리 차이 

![System Resources](../../images/Computer%20Vision%20images/컴퓨터비전_영상처리차이.png)

<br/>

### 영상 획득과 표현

- 영상 획득 과정은 매우 복잡하다

    - 실제로 빛이 들어와서 이미지가 만들어지는 과정은 여러 단계가 얽혀 있어 어려움 

<br/>

- **핀홀 카메라 모델** : 렌즈 없이 하나의 작은 구멍(핀홀)만으로 외부의 빛을 받아 화면에 상을 맺는 가장 단순한 카메라 모델

    - 복잡한 과정 중에서 **중요한 핵심만 간단하게** 설명할 수 있다
 
    - 핀홀 카메라의 원리를 이용해서 영상 획득 원리 (카메라의 기본 원리)를 간단하게 설명하자면
 
    - **빛이 직선으로만 이동**하기 때문에 위에 있는 물체에 반사된 빛은 구멍을 통과하기 위해 아래로 향하고, 아래쪽에서 반사된 빛은 위로 올라가서 구멍 뒤쪽에 **스크린**에 **뒤집혀** 보이는 현상이 발생한다
 
    - 이후 렌즈를 사용하게 되면서 더 많은 빛을 받아들이고 초점을 맞춰 선명하고 밝은 상을 얻음
 
        - 렌즈도 물체가 뒤집혀 보이지만 카메라 소프트웨어(펌웨어, ISP)가 이 데이터를 받아서 자동으로 상하·좌우를 반전시켜 저장


    - ![System Resources](../../images/Computer%20Vision%20images/핀홀카메라.png)

<br/>

### 영상 처리 과정 

![System Resources](../../images/Computer%20Vision%20images/영상처리과정.png)


- **피사체 (Object)**

    - 우리가 찍으려는 대상 (예: 사람, 나무, 자동차).

    - 빛을 반사해서 카메라 쪽으로 전달

    - 출발점: 영상 정보의 원천.

- **렌즈 (Lens)**

    - 피사체에서 반사된 빛을 모아 이미지 센서 위에 초점을 맺게 함

    - 빛을 굴절시켜 선명한 상을 센서에 맺히도록 조절

- **이미지 센서 (Image Sensor)**

    - 빛(광자)을 **전기 신호(전하)** 로 변환

    - 픽셀 단위로 빛의 세기(밝기, 색상)를 수치화

    - 즉, **빛 → 전기 신호 변환 장치**
 
    - 대표적으로 CCD, CMOS

- **ISP (Image Signal Processor)**

    - 센서에서 들어온 신호를 **디지털 영상으로** 가공

    - 노이즈 제거, 색 보정, 화이트 밸런스, 밝기·대비 조절 등을 수행 (뒤집힌 사진의 반전도 수행)

    - 거친 원본 신호 → **사람이 보기 좋은 영상**으로 보정

- **메모리 카드 (Memory Card)**

    - 최종적으로 처리된 영상을 **파일(JPEG, PNG, RAW 등)로 저장**

    - 이후 재생, 전송, 편집 등에 활용.
    
    - 완성본 보관소

<br/>

- 정리하면

    - 피사체에서 렌즈로 빛을 받음 ->  이미지 센서에서 전기신호로 변경 -> ISP에서 가공 -> 메모리 카드로 저장

<br/>

### 이미지 센서

- **CCD (Charge-Coupled Device)**
  - 픽셀에 모인 전하를 순차적으로 이동시켜 읽는 방식
  - 화질이 우수하고 노이즈가 적지만, 전력 소모가 크고 가격이 비쌈

- **CMOS (Complementary Metal-Oxide Semiconductor)**
  - 픽셀마다 증폭 회로를 두어 병렬적으로 전하를 읽는 방식
  - 저전력·고속·저가로 현재 대부분의 카메라에 사용됨

- **ToF (Time of Flight)**
  - 빛을 쏘고 반사되어 돌아오는 시간을 측정해 거리(깊이)를 계산
  - 빛의 비행 시간을 측정해 깊이(3D) 정보를 얻는 센서

- **IR (Infrared)**
  - 가시광선 대신 적외선 파장을 감지해 영상을 형성
  - 적외선을 감지해 어두운 환경이나 열을 측정하는 센서

<br/>

### 샘플링(sampling) & 양자화(quantization)

- 샘플링과 양자화는 ISP 단계의 핵심 과정이다 

- **샘플링(sampling)**

    - 원래 연속적인 영상을 가로 M, 세로 N개의 격자로 나누어 각각의 점(픽셀)에서 빛의 세기를 **대표값**으로 뽑아내는 과정
 
- **L 단계로 양자화 (quantization)**

    - 픽셀 값(**밝기나 색상**)을 L개 단계로 나누어 가장 가까운 값으로 바꿔주는 과정
 
    - 샘플링 과정에서는 연속적인 빛의 세기를 뽑았다면, 양자화 과정에서는 연속적인 값은 **이산적인 값**(0~255)으로 바꾸는 과정임
 
    - ![System Resources](../../images/Computer%20Vision%20images/샘플링양자화.png)
 
    - 또한 수학 그래프처럼 (0,0)이 가운데가 아니라, **왼쪽 위가 (0,0) 좌표**이다
 
        - (y, x) 표기 → 보통은 행(row), 열(column) 순서이기 때문
     
        - 함수에 따라 (x,y) 표기 사용하니 주의할 필요 
        
<br/>

### Tensor (텐서)

- Tensor : 수를 담는 다차원 배열(multidimensional array).


- 0차원 (스칼라, scalar)
    - 그냥 하나의 숫자
    - ex: 7, 3.14

- 1차원 (벡터, vector)
    - 숫자들이 일렬로 모여 있는 것
    - ex: [1, 2, 3, 4]

- 2차원 (행렬, matrix)

    - 가로·세로 격자로 정리된 것

![System Resources](../../images/Computer%20Vision%20images/tensor.png)

<br/>

### RGB 컬러 모델

- **RGB 컬러 모델** : 빛의 3원색(빨강, 초록, 파랑)으로 색을 표현하는 모델

    - 컴퓨터 모니터, 카메라 센서 등 디지털 장치의 기본 컬러 표현 방식
 
    - 하드웨어(디스플레이, 센서)와 직접적으로 호환됨
 
        - 기기(모니터, 카메라 센서 등)의 동작 원리 자체가 RGB 구조로 되어 있음
 
    - 인간의 직관적 색 지각과 차이가 있어, 색상·채도·명도를 따로 다루기 불편
 
        - 사람은 빨강/노랑/밝음/어두움 같은 직관적 단위로 색을 느끼지만, RGB는 단순히 세 가지 숫자(R,G,B)라서 색상, 채도, 명도를 구분하기 어려움

        - ![System Resources](../../images/Computer%20Vision%20images/RGB큐브.png)
 
<br/>

### HSV 컬러 모델

- **HSV 의미**

    - **Hue(색상)** : 빨강, 파랑, 초록 등 순수한 색의 종류

        - 𝐻 ∝ 색상간차이 

    - **Saturation(채도)** : 색의 선명함, 회색~원색까지의 비율

        - 𝑆 ∝max(𝑅,𝐺,𝐵) −min(𝑅,𝐺,𝐵) 

        - 채도가 높으면 선명한 색, 낮으면 흐린 회색에 가까움 

    - **Value(명도)** : 밝기 정도

        - 𝑉 =max(𝑅,𝐺,𝐵) 

- 인간이 색을 인식하는 방식에 가깝게 설계된 모델

    - 사람이 "밝다, 탁하다, 빨갛다"라고 느끼는 방식과 비슷하게 맞춰져 있음 

- 조명 변화에 어느 정도 강인

    - 같은 물체라도 조명이 달라질 때 RGB 값은 크게 변하지만, HSV는 비교적 일정하게 표현 가능 

- 계산 변환 과정이 필요해 **연산 비용이 RGB보다 큼**

    - RGB를 HSV로 바꾸려면 수학적 변환이 필요 → **계산량 증가**
 
![System Resources](../../images/Computer%20Vision%20images/HSV.png)
  
<br/>

### 이진 영상 (Binary Image)

- 화소가 **0(흑)** 또는 **1(백)** 인 영상

- 1 비트면 저장할 수 있는데, 편의상 **1바이트** 사용하는 경우가 많음

    - 이 부분은 컴퓨터 구조 관점이니 짧게만 설명
 
        - 컴퓨터의 두뇌(CPU)와 저장공간(메모리)은 데이터를 주고받을 때 최소 단위를 **1바이트(8비트 묶음)** 로 약속함
     
        - 그래서 편하게 가져오려고 1 바이트를 사용
     
        - **에지 검출 결과를 표시**하거나 물체와 배경을 **구분**하여 표시하는 응용 등에 사용
     
            - 검은색 배경에 오직 검출된 윤곽선만 흰색으로 표시하기 때문에 **핵심 정보를 뚜렷하게** 보여주기 때문
         
            - ![System Resources](../../images/Computer%20Vision%20images/01-2장이진영상예시그림.png)

<br/>

- **임계값**을 이용하여 흑백을 구분

    - ![System Resources](../../images/Computer%20Vision%20images/01-2장이진영상임계값.png)

    - 좋은 임계값을 정하는 방법 중 하나는, 이미지 히스토그램에서 밝은 영역과 어두운 영역의 봉우리 사이 **계곡에 해당하는 값**을 선택하는 것
 
        - ![System Resources](../../images/Computer%20Vision%20images/01-2장임계값설정방법.png)

<br/>

- **R G B 채널 내부 정보**

    - ![System Resources](../../images/Computer%20Vision%20images/01-2장RGB컬러예시.png) 

    - 위 예시는 컬러 이미지를 흑백 이미지로 변경한 것이다
 
        - 여기서 **주의할 점**은 이진 영상은 오직 0과 1인 영상인 것이고 위 예시는 회색까지 포함하는 **흑백 영상**이다
     
    - R, G, B 채널에 따라 **어떤 부분이 더 밝고 어두인지가 다르다**
 
        - Red 채널로 세상을 본다면, 빨간색 물체가 필터를 통과해 빛이 더 많이 들어와서 **가장 밝게 나온다** (G와 B도 각자의 색이 가장 밝게 나온다)
     
        - 쉽게 말해서, **각자 채널은 그 색의 세기를 기준으로 판단**한다
 
    - 컬러 이미지를 흑백 영상으로 변환하는 공식은 아래와 같다
 
        - **Grayscale = (0.299 × R) + (0.587 × G) + (0.114 × B)**
     
        - 이 공식은 'ITU-R BT.601' 이라는 국제 표준에서 정의된 휘도(Luminance, Y), 즉 사람이 인지하는 밝기를 계산하는 식이다 

<br/>

### 오츄(Ostu) 알고리즘

- 이진 영상을 만드는 **최적의 임계값(Threshold)을 구하** 알고리즘

    - 원리 :  그룹 간 **분산을 최대**로 만드는 것'
 
    - ![System Resources](../../images/Computer%20Vision%20images/01-2장오츄알고리즘공식1.png)
 
        - n0(t) : 임계값 t로 이진화 했을 때 0에 속한 픽셀의 개수
     
        - v0(t) : 그룹 0에 속한 픽셀들의 밝기값에 대한 분산
     
        - **그룹 별로 분산을 최대화** 한다는 것은 각 그룹은 **자신의 그룹을 잘 설명하기 위해** 그룹 내부의 분산은 **반대로 작아야 한다**
     
            - ![System Resources](../../images/Computer%20Vision%20images/01-2장오츄알고리즘공식2.png)

<br/>

- 예시 문제

    - ![System Resources](../../images/Computer%20Vision%20images/01-2장오츄알고리즘예시문제.png)
 
    - 위 예시를 보면 **가중치는 (해당 그룹에 속한 픽셀의 총개수) / (이미지의 전체 픽셀 수)** 로 구한다
 
    - 분산 공식은 시그마 제곱을 이용해서 풀이함
 
<br/>

### 4-연결성 & 8-연결성

- **연결성(Connectivity)** : 이미지에서 어떤 픽셀들이 **서로 이웃인지**를 정의하는 규칙
 
    - 이진 영상에서 사용  

    - **4-연결성** : 어떤 픽셀의 상, 하, 좌, 우에 있는 픽셀만을 이웃으로 인정하는 방식 (십자 모양)

    - **8-연결성** : 상, 하, 좌, 우뿐만 아니라 대각선에 있는 픽셀까지 모두 이웃으로 인정하는 방식 (3x3 정사각형 모양)
 
    - ![System Resources](../../images/Computer%20Vision%20images/01-2장연결성구조사진.png)

<br/>

- **연결성을 사용하는 이유** : 이미지에 있는 여러 객체 덩어리를 각각 별개의 것으로 인식하고 분리하기 위해서이다
   
 <br/>

 - **연결성을 이용한 검사 과정**

    - 픽셀을 왼쪽 위부터 오른쪽을 순차적으로 이동하고 도착하면 다음 열로 이동하여 이것을 반복한다
 
    - 4-연결성을 예로 들자면, 검사를 할땨 **이전에 거쳐온** 상하좌우에 해당하는 부분의 픽셀이 바뀌지 않으면 같은 그룹으로 인식함
  
    - 이것을 반복하여 그룹을 분리 

<br/>
  
- **연결성 예시**

    - ![System Resources](../../images/Computer%20Vision%20images/01-2장연결성과정설명그림.png)
 
    - 4 연결성을 보면 처음에 맨 위에서 탐색
 
    - 첫 행은 모두 0이므로 건너 뜀 (**1만 검사**)
 
    - 2행 2열에서 처음 1 발견 -> 이전에 거쳐온 길을 봤을 때, 왼쪽과 위쪽의 변화가 없으므로 여기서부터 1번 그룹 시작
 
        - 2행 3열에서 1 발견 -> 이전에 거쳐온 왼쪽이 변화 -> 이 부분도 그룹 1로 판단
     
    - 3행 5열에서 1 발견 -> 이전에 거쳐온 길에서 변화 x -> 새로운 그룹 2로 판단
 
        - 여기서 **2는 화솟값의 변화가 아니라 그룹의 이름** 

<br/>

### 모폴로지

- **정의** : 이미지 속 객체의 형태나 **구조를 분석**하고 **변형**하는 이미지 처리 기술

    - 연결성에서 사용한 규칙을 바탕으로 수행한다 (다양한 구조도 존재)

<br/>

- **대표적인 처리 유형**

    - **팽창** : 작은 흠을 메우거나 끊어진 영역을 연결
 
    - **침식** : 경계에 솟은 돌출 부분을 깎는 효과 -> 영역을 작게 만듦
 
    - **열림** : 침식한 결과에 팽창 적용. 원래 영역 크기 유지
 
    - **닫힘** :  팽창한 결과에 침식 적용. 원래 영역 크기 유지

<br/>

### 팽창 & 침식 과정 

- **팽창 과정**

    - 구조요소의 중심이 1인 화소 (흰색 부분)를 이동하며 영역 밖으로 튀어나온 부분의 화솟값을 1로 변환

    - ![System Resources](../../images/Computer%20Vision%20images/01-2장팽창과정.png)

<br/>

- **침식 과정**

    - 구조요소의 중심이 1인 화소 (흰색 부분)를 이동하며 모든 영역이 내부에 존재하면 가운데 값만 1로 변환
 
    - ![System Resources](../../images/Computer%20Vision%20images/01-2장침식과정.png)

<br/>

### 열기 & 닫기 과정 

- 열기 : 침식 후 팽창

- 닫기 : 팽창 후 침식

- ![System Resources](../../images/Computer%20Vision%20images/01-2장열기닫기.png)



